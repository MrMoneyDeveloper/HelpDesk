@using C8.eServices.Mvc.Models;
@{
    ViewBag.Title = "OnboardEmployee";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}



<html lang="en">
<head>
    <link href="~/assets/libs/jsvectormap/css/jsvectormap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />
  


    <link href="~/assets/libs/choices.js/public/assets/styles/choices.min.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/libs/flatpickr/flatpickr.min.css" rel="stylesheet">

    <!-- One of the following themes -->
    <link rel="stylesheet" href="~/assets/libs/simonwep/pickr/themes/classic.min.css" /> <!-- 'classic' theme -->
    <link rel="stylesheet" href="~/assets/libs/simonwep/pickr/themes/monolith.min.css" /> <!-- 'monolith' theme -->
    <link rel="stylesheet" href="~/assets/libs/simonwep/pickr/themes/nano.min.css" /> <!-- 'nano' theme -->

    <!-- Include the flatpickr styles from CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,100,0,-25" />



    <style>
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            Preferred icon size display: inline-block;
            line-height: 1;
            text-transform: none;
            letter-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            direction: ltr;
            color: cornflowerblue;
            Support for all WebKit browsers. -webkit-font-smoothing: antialiased;
            Support for Safari and Chrome. text-rendering: optimizeLegibility;
            Support for Firefox. -moz-osx-font-smoothing: grayscale;
            Support for IE. font-feature-settings: 'liga';
        }

       


        .form-select-dark {
            background-color: #343a40; /* Dark background color */
            color: #ffffff; /* Text color */
        }

            .form-select-dark option {
                background-color: #343a40; /* Dark background color */
                color: #ffffff; /* Text color */
            }
    </style>






</head>
<body>
    <div class="main-content">

        <div class="page-content">
            <div class="container-fluid">

                <!-- start page title -->
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box d-flex align-items-center justify-content-between">
                           

                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Signup</a></li>
                                    <li class="breadcrumb-item active">Onboarding Request</li>
                                </ol>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- end page title -->

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-header text-center">
                                <h4 class="card-title">Onboarding Employee</h4>
                            </div><!-- end card header -->
                          

                            @using (Html.BeginForm("OnboardEmployee", "Onboarding", FormMethod.Post, new { id = "companyForm" }))
                            {
                                @Html.AntiForgeryToken()
                                <div class="card-body">
                                    <ul class="wizard-nav mb-5">
                                        <li class="wizard-list-item">
                                            <div class="list-item">
                                                <div class="step-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="XET Employee">
                                                    <i class="uil uil-clipboard-notes"></i>
                                                </div>
                                            </div>
                                        </li>
                                        @*<li class="wizard-list-item">
                        <div class="list-item">
                            <div class="step-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Primary Contact Person">
                                <i class="uil uil-user-check"></i>
                            </div>
                        </div>
                    </li>*@
                                    </ul>
                                    <ul class="wizard-nav mb-5">
                                        <li class="wizard-list-item">
                                            <div class="list-item">
                                                <!-- error message here -->
                                                <div class="alert alert-danger alert-top-border alert-dismissible fade show col-md-5" role="alert" style="margin-left:350px; display:none;" id="errorId">
                                                    <i class="uil uil-exclamation-octagon font-size-16 text-danger me-2"></i>
                                                    Please fill in all required fields.
                                                    <button type="button" onclick="addHidden()" class="btn-close" @*data-bs-dismiss="alert"*@ aria-label="Close"></button>
                                                </div>
                                                <!-- error message here 3nd -->
                                            </div>
                                        </li>


                                    </ul>

                                    <!-- wizard-tab -->

                                    <div class="wizard-tab">
                                        <div class="text-center mb-4">
                                            <h5>Onboard XET Employee</h5>
                                            <p class="card-title-desc">Fill all information below</p>
                                        </div>
                                        <div>
                                            <div class="row">
                                                <div class="col-lg-6">

                                                    <div class="input-group mb-3">


                                                        <span class=" input-group-text material-symbols-outlined">
                                                            person
                                                        </span>
                                                        @*<input type="text" class="form-control" aria-label="First name" aria-describedby="inputGroup-sizing-default" placeholder="First name">*@
                                                        <input type="text" class="form-control" id="basicpill-firstname-input" name="FirstName" required placeholder="First Name">
                                                    </div>

                                                </div><!-- end col -->
                                                <div class="col-lg-6">
                                                    <div class="input-group mb-3">
                                                      
                                                        <span class=" input-group-text material-symbols-outlined">
                                                            group
                                                        </span>
                                                        @*<label for="basicpill-lastname-input" class="form-label d-none">Last Name</label>*@
                                                        <input type="text" class="form-control" id="basicpill-lastname-input" name="LastName" required placeholder="Last Name">
                                                    </div>

                                                </div><!-- end col -->
                                            </div><!-- end row -->

                                            <div class="row">
                                                <div class="col-lg-6">
                                                    <div class="input-group mb-3">
                                                        <span class="input-group-text material-symbols-outlined">
                                                            call
                                                        </span>
                                                        <input type="text" class="form-control" id="basicpill-phoneno-input" name="phone" required placeholder="Phone">
                                                    </div>


                                                </div><!-- end col -->
                                                <div class="col-lg-6">
                                                    <div class="input-group mb-3">
                                                       
                                                        <span class="input-group-text material-symbols-outlined">
                                                            mail
                                                        </span>
                                                        <!-- <label for="basicpill-email-input" class="form-label">Email</label> -->
                                                        <input type="email" class="form-control" id="basicpill-email-input" name="email" required placeholder="Email">
                                                    </div>

                                                </div><!-- end col -->
                                            </div><!-- end row -->

                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="input-group mb-3">

                                                        <span class="input-group-text material-symbols-outlined">
                                                            settings_accessibility
                                                        </span>
                                                        <select class="form-select" name="Title" required>
                                                            <option value="">Select Title</option>
                                                            @foreach (var title in ViewBag.PossibleTitles as List<string>)
                                                            {
                                                                <option value="@title">@title</option>
                                                            }
                                                        </select>
                                                    </div>

                                                </div><!-- end col -->
                                                <div class="col-lg-4">
                                                    <div class="input-group mb-3">
                                                        
                                                        <span class="input-group-text  material-symbols-outlined">
                                                            badge
                                                        </span>
                                                        <select class="form-select" name="Title" required id="employeeTypeDropdown">
                                                            <option value="">Select Employee Type</option>
                                                            @foreach (var employeeType in ViewBag.EmployeeTypes as List<EmployeeType>)
                                                            {
                                                                <option value="@employeeType.Id">@employeeType.Name</option>
                                                            }
                                                        </select>
                                                    </div>

                                                </div><!-- end col -->
                                                <div class="col-lg-4">
                                                    <div class="input-group mb-3">
                                                      
                                                        <span class="input-group-text material-symbols-outlined">
                                                            business_center
                                                        </span>
                                                        <select class="form-select" name="Designation" required id="designationDropdown">
                                                            <option value="">Select Designation</option>
                                                        </select>
                                                    </div>

                                                </div><!-- end col -->
                                            </div><!-- end row -->

                                            <div class="row">

                                            </div><!-- end row -->
                                        </div>

                                    </div>





                                    <div class="d-flex align-items-start gap-3 mt-4">
                                        <button type="button" class="btn btn-primary w-sm" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
                                        <button type="button" class="btn btn-primary w-sm ms-auto" id="nextBtn" onclick="checkButtonLabel();">Next</button>
                                        <div style="display:none;">
                                            <input type="submit" onclick="validateForm()" id="idSubmitForm" />
                                        </div>

                                    </div>

                                </div>



                            }



                        </div>
                    </div><!-- end col -->
                </div><!-- end row -->

            </div> <!-- container-fluid -->
        </div>
    </div>

    <div class="rightbar-overlay"></div>
    <script src="~/assets/js/pages/form-wizard.init.js"></script>
    <script src="~/assets/js/pages/form-advanced.init.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</body>
</html>

<script>
    function addHidden() {
        $('#errorId').css({
            'display': 'none',
            'margin-left': '350px'
        });
    }

    function validateForm() {
        const requiredFields = document.querySelectorAll('#companyForm input[required], #companyForm select[required]');

        for (let i = 0; i < requiredFields.length; i++) {
            if (!requiredFields[i].value) {
                $('#errorId').css({
                    'display': 'block',
                    'margin-left': '70px',
                    'width': '300px'
                });
                return false;
            }
        }
        OnboardEmployee();
    }

    function checkButtonLabel() {
        const button = document.getElementById('nextBtn');
        const buttonText = button.innerText || button.textContent;

        if (buttonText.trim().toLowerCase() === 'submit') {
            document.getElementById("idSubmitForm").click();
        } else {
            nextPrev(1);
        }
    }

    function OnboardEmployee() {

        let firstname = document.getElementById('firstnameId').value;
        let lastname = document.getElementById('lastnameId').value;
        let email = document.getElementById('emailId').value;
        let phone = document.getElementById('phoneId').value;
        let periodTo = document.getElementById('periodToId').value; // Get the value of the "Period To" field

        let title = document.getElementById('employeeTypeDropdown').value; // Get the value of the Title field
        let designation = document.getElementById('designationDropdown').value; // Get the value of the Designation field
       $.ajax({
        url: '@Url.Action("OnboardEmployee", "Onboarding")',
        type: 'POST',
        dataType: 'json',
        data: {
            Firstname: firstname,
            LastName: lastname,
            Email: email,
            Phone: phone,
            Title: title,
            Designation: designation,
            PeriodTo: periodTo
        },
        success: function (response) {
            if (response.status) {
                document.getElementById("companyForm").reset();
                document.getElementById('btnCloseOnboardingId').click();
                nextPrev(-1);
                alertify.success("Onboarding Request Submitted");
                setTimeout(function () {
                    alertify.success("An email has been sent to: " + response.email);
                    alert("First Name: " + response.FirstName +
                          "\nLast Name: " + response.LastName +
                          "\nEmail: " + response.Email +
                          "\nPhone: " + response.Phone +
                          "\nTitle: " + response.Title +
                          "\nDesignation: " + response.Designation +
                          "\nPeriod To: " + response.PeriodTo);
                }, 3000);
                } else {
                    alert('Failed to submit the request');
                }
            },
            error: function (xhr, status, error) {
                console.log('Request failed: ' + status + ', ' + error);
            }
        });
    }


     @*const allDesignations = @Html.Raw(Json.Encode(ViewBag.Designations));*@

    //$("#employeeTypeDropdown").on('change', function () {
    //    var s = $("#employeeTypeDropdown").val();
    //         alert(s);
    //        const selectedEmployeeTypeId = parseInt(this.value);
    //        const filteredDesignations = allDesignations.filter(d => d.EmployeeTypeId === selectedEmployeeTypeId);
    //        updateUIWithFilteredDesignations(filteredDesignations);
    //    });

    $(document).ready(function () {
        // Change event handler for employeeTypeDropdown
        $("#employeeTypeDropdown").on('change', function () {
            const selectedEmployeeTypeId = parseInt($(this).val());

            $.ajax({
                url: '/Onboarding/GetDesignationsByEmployeeType',
                type: 'GET',
                data: { employeeTypeId: selectedEmployeeTypeId },
                success: function (data) {
                    // Update the designationDropdown with the filtered designations
                    populateDesignationDropdown(data);
                },
                error: function () {
                    alert("Error retrieving designations.");
                }
            });
        });

        function populateDesignationDropdown(filteredDesignations) {
            const designationDropdown = $("#designationDropdown");
            designationDropdown.empty(); // Clear existing options
            designationDropdown.append('<option value="">Select Designation</option>'); // Add default option

            // Add filtered designations to the dropdown
            filteredDesignations.forEach(function (designation) {
                designationDropdown.append('<option value="' + designation.Id + '">' + designation.Name + '</option>');
            });
        }

        $("#employeeTypeDropdown").on('change', function () {
            const selectedEmployeeTypeId = parseInt($(this).val());

            $.ajax({
                url: '/ControllerName/GetDesignationsByEmployeeType', // Replace with the correct URL
                type: 'GET',
                data: { employeeTypeId: selectedEmployeeTypeId },
                success: function (data) {
                    updateUIDesignations(data);
                },

            });
        });

        function updateUIDesignations(filteredDesignations) {
            const designationDropdown = $("#designationDropdown");
            designationDropdown.empty();
            designationDropdown.append('<option value="">Select Designation</option>');

            filteredDesignations.forEach(function (designation) {
                designationDropdown.append('<option value="' + designation.Id + '">' + designation.Name + '</option>');
            });
        }

    });

</script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/dist/js/alertify.js"></script>